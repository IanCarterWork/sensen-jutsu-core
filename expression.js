import { NativeDirectiveAttributes } from "./directive.native";
import { ArrayRange } from "./utilities";
/**
 * Expressions
 */
export const SyntaxEcho = new RegExp('{{(.*?)}}', 'g');
export const SyntaxSnapCode = new RegExp('{%(.*?)%}', 'g');
export const SyDetr = '%sn';
export const DirectiveAttributes = NativeDirectiveAttributes;
/**
 * Stabilize Echo Expression
 */
export function StabilizeEchoExpression(content, stop) {
    const echos = [...(content || '').matchAll(SyntaxEcho)];
    if (echos.length) {
        echos.map(m => {
            content = (content || '').replace(new RegExp((m[0]).replace(/[^\w\s]/gi, '\\$&'), 'g'), `<${SyDetr}=${m[1]} ${SyDetr}>`);
        });
    }
    else {
        if (stop) {
            return null;
        }
    }
    return content;
}
/**
 * Stabilize SnapCode Expression
 */
export function StabilizeSnapCodeExpression(content, stop) {
    const echos = [...(content || '').matchAll(SyntaxSnapCode)];
    if (echos.length) {
        echos.map(m => {
            content = (content || '').replace(new RegExp((m[0]).replace(/[^\w\s]/gi, '\\$&'), 'g'), `<${SyDetr}${m[1]} ${SyDetr}>`);
        });
    }
    else {
        if (stop) {
            return null;
        }
    }
    return content;
}
export function CreateExpressionRecord(state) {
    if ((state.node instanceof HTMLElement || state.node instanceof Node) && !state.mockup) {
        state.mockup = state.node.cloneNode(true);
    }
    return state;
}
/**
 * Parse Attributes
 */
export function ParseAttributesExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    if (node.attributes) {
        if (node.attributes.length) {
            Object.values(node.attributes).map(attribute => {
                /**
                 * Find Directive
                 */
                Object.values(NativeDirectiveAttributes.Availables || {})
                    .map(directive => {
                    const matches = [...attribute.name.matchAll(new RegExp(`^${directive.expression}`, 'gi'))];
                    if (matches.length) {
                        matches.forEach(match => {
                            const split = attribute.name?.substring((directive.expression || '')?.length).split('.');
                            const name = split[0];
                            const record = CreateExpressionRecord({
                                node,
                                directive,
                                match,
                                name,
                                type: 'directive',
                                mockup: attribute,
                                arguments: ArrayRange(split, 1)
                            });
                            callback(record);
                        });
                    }
                });
                /**
                 * Find Echo
                 */
                const matchesEcho = [...attribute.value.matchAll(SyntaxEcho)];
                if (matchesEcho.length) {
                    matchesEcho.forEach(match => {
                        const record = CreateExpressionRecord({
                            node,
                            attribute,
                            match,
                            type: 'attribute.echo',
                            mockup: attribute
                        });
                        callback(record);
                    });
                }
                /**
                 * Find SnapCode
                 */
                const matchesSnapCode = [...attribute.value.matchAll(SyntaxSnapCode)];
                if (matchesSnapCode.length) {
                    matchesSnapCode.forEach(match => {
                        const record = CreateExpressionRecord({
                            node,
                            attribute,
                            match,
                            type: 'attribute.snapcode',
                            mockup: attribute
                        });
                        callback(record);
                    });
                }
            });
        }
    }
    return ParseAttributesExpression;
}
/**
 * Parse Echo Expression
 */
export function ParseEchoExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    const content = (node instanceof Text)
        ? node.textContent
        : (node instanceof HTMLElement ? node.innerHTML : null);
    let found = false;
    if (content) {
        const matches = [...content?.matchAll(SyntaxEcho)];
        if (matches.length) {
            found = true;
            matches.forEach(match => {
                const record = CreateExpressionRecord({
                    node,
                    name: (match[1] || '').trim(),
                    type: 'echo',
                    echo: content,
                    match
                });
                callback(record);
            });
            // console.log('Parse Echo', record)
        }
    }
    return found;
}
/**
 * Parse SnapCode Expression
 */
export function ParseSnapCodeExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    let found = false;
    if (node.childNodes.length) {
        const record = CreateExpressionRecord({
            node,
            type: 'snapcode',
            snapcode: []
        });
        node.childNodes.forEach(child => {
            const m = [];
            if (child instanceof Text) {
                if (child.textContent) {
                    const matches = [...child.textContent.matchAll(SyntaxSnapCode)];
                    if (matches.length) {
                        m.push({ node: child, matches });
                        // record.snapcode?.push( { node: child, matches } )
                    }
                }
            }
            if (m.length) {
                record.snapcode = m;
                callback(record);
            }
        });
        if (record.snapcode) {
            if (record.snapcode.length) {
                found = true;
            }
        }
    }
    return found;
}
export function FindExpressions(node, callback) {
    const nodes = node.childNodes;
    const recorder = [];
    /**
     * Parse Node Attributes
     */
    ParseAttributesExpression(node, callback);
    /**
     * ReCallBack
     */
    const reCallback = (record) => {
        recorder.push(record);
        callback(record);
    };
    /**
     * Find
     */
    if (nodes.length) {
        nodes.forEach(child => {
            /** * Find SnapCode */
            const snapcode = ParseSnapCodeExpression(child, reCallback);
            /** * Find Deep */
            if (!snapcode) {
                FindExpressions(child, reCallback);
            }
            else {
                // console.warn('Stop Find on', child)
            }
        });
    }
    if (!nodes.length) {
        /**
         * Find Echo
         */
        ParseEchoExpression(node, reCallback);
    }
    return recorder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV4cHJlc3Npb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFL0QsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUd6Qzs7R0FFRztBQUtILE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDLENBQUE7QUFFdEQsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLElBQUksTUFBTSxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQTtBQUUxRCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFBO0FBRzNCLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLHlCQUF5QixDQUFBO0FBSzVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLHVCQUF1QixDQUFDLE9BQXNCLEVBQUUsSUFBYztJQUUxRSxNQUFNLEtBQUssR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLElBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUE7SUFFckQsSUFBRyxLQUFLLENBQUMsTUFBTSxFQUFDO1FBRVosS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUEsRUFBRTtZQUVULE9BQU8sR0FBRyxDQUFDLE9BQU8sSUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQzNCLElBQUksTUFBTSxDQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsRUFBRyxHQUFHLENBQUUsRUFDdkQsSUFBSSxNQUFNLElBQUssQ0FBQyxDQUFDLENBQUMsQ0FBRSxJQUFJLE1BQU0sR0FBRyxDQUNwQyxDQUFBO1FBRUwsQ0FBQyxDQUFDLENBQUE7S0FFTDtTQUVHO1FBRUEsSUFB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QztBQUVqQixDQUFDO0FBR0QsTUFBTSxVQUFVLGVBQWUsQ0FFM0IsSUFBaUIsRUFFakIsUUFBNEM7SUFNNUMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUU5QixNQUFNLFFBQVEsR0FBdUIsRUFBRSxDQUFBO0lBR3ZDOztPQUVHO0lBQ0gseUJBQXlCLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBSXpDOztPQUVHO0lBRUgsTUFBTSxVQUFVLEdBQUcsQ0FBQyxNQUF3QixFQUFDLEVBQUU7UUFFM0MsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUVyQixRQUFRLENBQUMsTUFBTSxDQUFDLENBQUE7SUFFcEIsQ0FBQyxDQUFBO0lBSUQ7O09BRUc7SUFDSCxJQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUM7UUFFWixLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQSxFQUFFO1lBRWpCLHNCQUFzQjtZQUN0QixNQUFNLFFBQVEsR0FBRyx1QkFBdUIsQ0FBQyxLQUFvQixFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRzNFLGtCQUFrQjtZQUNsQixJQUFHLENBQUMsUUFBUSxFQUFDO2dCQUVULGVBQWUsQ0FBQyxLQUFvQixFQUFFLFVBQVUsQ0FBQyxDQUFBO2FBRXBEO2lCQUVHO2dCQUVBLHNDQUFzQzthQUV6QztRQUVMLENBQUMsQ0FBQyxDQUFBO0tBRUw7SUFHRCxJQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBQztRQUViOztXQUVHO1FBQ0gsbUJBQW1CLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFBO0tBRXhDO0lBRUQsT0FBTyxRQUFRLENBQUM7QUFFcEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5hdGl2ZURpcmVjdGl2ZUF0dHJpYnV0ZXMgfSBmcm9tIFwiLi9kaXJlY3RpdmUubmF0aXZlXCI7XG5pbXBvcnQgeyBFeHByZXNzaW9uUmVjb3JkLCBQYXJzZVNuYXBDb2RlQmxvY2sgfSBmcm9tIFwiLi9pbmRleC50XCI7XG5pbXBvcnQgeyBBcnJheVJhbmdlIH0gZnJvbSBcIi4vdXRpbGl0aWVzXCI7XG5cblxuLyoqXG4gKiBFeHByZXNzaW9uc1xuICovXG5cblxuXG5cbmV4cG9ydCBjb25zdCBTeW50YXhFY2hvID0gbmV3IFJlZ0V4cCgne3soLio/KX19JywgJ2cnKVxuXG5leHBvcnQgY29uc3QgU3ludGF4U25hcENvZGUgPSBuZXcgUmVnRXhwKCd7JSguKj8pJX0nLCAnZycpXG5cbmV4cG9ydCBjb25zdCBTeURldHIgPSAnJXNuJ1xuXG5cbmV4cG9ydCBjb25zdCBEaXJlY3RpdmVBdHRyaWJ1dGVzID0gTmF0aXZlRGlyZWN0aXZlQXR0cmlidXRlc1xuXG5cblxuXG4vKipcbiAqIFN0YWJpbGl6ZSBFY2hvIEV4cHJlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFN0YWJpbGl6ZUVjaG9FeHByZXNzaW9uKGNvbnRlbnQ6IHN0cmluZyB8IG51bGwsIHN0b3A/OiBib29sZWFuKXtcblxuICAgIGNvbnN0IGVjaG9zID0gWy4uLihjb250ZW50fHwnJykubWF0Y2hBbGwoU3ludGF4RWNobyldXG4gICAgIFxuICAgIGlmKGVjaG9zLmxlbmd0aCl7XG4gICAgICAgIFxuICAgICAgICBlY2hvcy5tYXAobT0+e1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb250ZW50ID0gKGNvbnRlbnR8fCcnKS5yZXBsYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSZWdFeHAoIChtWzBdKS5yZXBsYWNlKC9bXlxcd1xcc10vZ2ksICdcXFxcJCYnKSAsICdnJyApLCBcbiAgICAgICAgICAgICAgICBgPCR7U3lEZXRyfT0keyBtWzFdIH0gJHtTeURldHJ9PmAgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIH0pXG4gICAgICAgICAgICBcbiAgICB9XG5cbiAgICBlbHNle1xuXG4gICAgICAgIGlmKHN0b3ApeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRlbnQ7XG5cbn1cblxuXG5cblxuLyoqXG4gKiBTdGFiaWxpemUgU25hcENvZGUgRXhwcmVzc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gU3RhYmlsaXplU25hcENvZGVFeHByZXNzaW9uKGNvbnRlbnQ6IHN0cmluZyB8IG51bGwsIHN0b3A/OiBib29sZWFuKXtcblxuICAgIGNvbnN0IGVjaG9zID0gWy4uLihjb250ZW50fHwnJykubWF0Y2hBbGwoU3ludGF4U25hcENvZGUpXVxuICAgICBcbiAgICBpZihlY2hvcy5sZW5ndGgpe1xuICAgICAgICBcbiAgICAgICAgZWNob3MubWFwKG09PntcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29udGVudCA9IChjb250ZW50fHwnJykucmVwbGFjZShcbiAgICAgICAgICAgICAgICBuZXcgUmVnRXhwKCAobVswXSkucmVwbGFjZSgvW15cXHdcXHNdL2dpLCAnXFxcXCQmJykgLCAnZycgKSwgXG4gICAgICAgICAgICAgICAgYDwke1N5RGV0cn0keyBtWzFdIH0gJHtTeURldHJ9PmAgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIH0pXG4gICAgICAgICAgICBcbiAgICB9XG5cbiAgICBlbHNle1xuXG4gICAgICAgIGlmKHN0b3ApeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbnRlbnQ7XG5cbn1cblxuXG5cblxuXG5leHBvcnQgZnVuY3Rpb24gQ3JlYXRlRXhwcmVzc2lvblJlY29yZChzdGF0ZTogRXhwcmVzc2lvblJlY29yZCkgOiBFeHByZXNzaW9uUmVjb3Jke1xuXG4gICAgaWYoKHN0YXRlLm5vZGUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCB8fCBzdGF0ZS5ub2RlIGluc3RhbmNlb2YgTm9kZSkgJiYgIXN0YXRlLm1vY2t1cCl7XG5cbiAgICAgICAgc3RhdGUubW9ja3VwID0gc3RhdGUubm9kZS5jbG9uZU5vZGUodHJ1ZSlcblxuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZVxuXG59XG5cblxuXG4vKipcbiAqIFBhcnNlIEF0dHJpYnV0ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFBhcnNlQXR0cmlidXRlc0V4cHJlc3Npb24obm9kZTogSFRNTEVsZW1lbnQsIGNhbGxiYWNrOiAocmVjb3JkOiBFeHByZXNzaW9uUmVjb3JkKSA9PiB2b2lkICl7XG5cblxuICAgIGNhbGxiYWNrID0gdHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6ICgoKT0+e30pO1xuXG5cbiAgICBpZihub2RlLmF0dHJpYnV0ZXMpe1xuICAgICAgICAgICAgXG4gICAgICAgIGlmKG5vZGUuYXR0cmlidXRlcy5sZW5ndGgpe1xuICAgIFxuICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhub2RlLmF0dHJpYnV0ZXMpLm1hcChhdHRyaWJ1dGU9PntcbiAgICBcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEZpbmQgRGlyZWN0aXZlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhOYXRpdmVEaXJlY3RpdmVBdHRyaWJ1dGVzLkF2YWlsYWJsZXN8fHt9KVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLm1hcChkaXJlY3RpdmU9PnsgXG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlcyA9IFsuLi5hdHRyaWJ1dGUubmFtZS5tYXRjaEFsbChuZXcgUmVnRXhwKGBeJHsgZGlyZWN0aXZlLmV4cHJlc3Npb24gfWAsICdnaScpKV1cblxuICAgICAgICAgICAgICAgICAgICBpZihtYXRjaGVzLmxlbmd0aCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMuZm9yRWFjaChtYXRjaD0+e1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXQgPSBhdHRyaWJ1dGUubmFtZT8uc3Vic3RyaW5nKChkaXJlY3RpdmUuZXhwcmVzc2lvbnx8JycpPy5sZW5ndGgpLnNwbGl0KCcuJylcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBzcGxpdFswXVxuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmQgPSBDcmVhdGVFeHByZXNzaW9uUmVjb3JkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aXZlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RpcmVjdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vY2t1cDogYXR0cmlidXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmd1bWVudHM6IEFycmF5UmFuZ2U8c3RyaW5nPihzcGxpdCwgMSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlY29yZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KVxuXG5cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEZpbmQgRWNob1xuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXNFY2hvID0gWy4uLmF0dHJpYnV0ZS52YWx1ZS5tYXRjaEFsbChTeW50YXhFY2hvKV07XG5cbiAgICAgICAgICAgICAgICBpZihtYXRjaGVzRWNoby5sZW5ndGgpe1xuXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZXNFY2hvLmZvckVhY2gobWF0Y2g9PntcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gQ3JlYXRlRXhwcmVzc2lvblJlY29yZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2F0dHJpYnV0ZS5lY2hvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2NrdXA6IGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcblxuXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBGaW5kIFNuYXBDb2RlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlc1NuYXBDb2RlID0gWy4uLmF0dHJpYnV0ZS52YWx1ZS5tYXRjaEFsbChTeW50YXhTbmFwQ29kZSldO1xuXG4gICAgICAgICAgICAgICAgaWYobWF0Y2hlc1NuYXBDb2RlLmxlbmd0aCl7XG5cbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1NuYXBDb2RlLmZvckVhY2gobWF0Y2g9PntcblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gQ3JlYXRlRXhwcmVzc2lvblJlY29yZCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2F0dHJpYnV0ZS5zbmFwY29kZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9ja3VwOiBhdHRyaWJ1dGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlY29yZClcblxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSlcbiAgICBcbiAgICBcbiAgICAgICAgfVxuXG4gICAgfVxuICAgIFxuICAgIFxuICAgIHJldHVybiBQYXJzZUF0dHJpYnV0ZXNFeHByZXNzaW9uO1xuICAgIFxufVxuXG5cblxuLyoqXG4gKiBQYXJzZSBFY2hvIEV4cHJlc3Npb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFBhcnNlRWNob0V4cHJlc3Npb24obm9kZTogSFRNTEVsZW1lbnQsIGNhbGxiYWNrOiAocmVjb3JkOiBFeHByZXNzaW9uUmVjb3JkKSA9PiB2b2lkICl7XG5cbiAgICBjYWxsYmFjayA9IHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nID8gY2FsbGJhY2sgOiAoKCk9Pnt9KTtcblxuICAgIGNvbnN0IGNvbnRlbnQgPSAobm9kZSBpbnN0YW5jZW9mIFRleHQpIFxuICAgICAgICA/IG5vZGUudGV4dENvbnRlbnQgXG4gICAgICAgIDogKG5vZGUgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA/IG5vZGUuaW5uZXJIVE1MIDogbnVsbCk7XG5cbiAgICBcbiAgICBsZXQgZm91bmQgPSBmYWxzZVxuXG5cbiAgICBpZihjb250ZW50KXtcblxuICAgICAgICBjb25zdCBtYXRjaGVzID0gWy4uLmNvbnRlbnQ/Lm1hdGNoQWxsKFN5bnRheEVjaG8pXVxuXG4gICAgICAgIGlmKG1hdGNoZXMubGVuZ3RoKXtcblxuICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuXG4gICAgICAgICAgICBtYXRjaGVzLmZvckVhY2gobWF0Y2g9PntcblxuICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IENyZWF0ZUV4cHJlc3Npb25SZWNvcmQoe1xuICAgICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAobWF0Y2hbMV18fCcnKS50cmltKCksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlY2hvJyxcbiAgICAgICAgICAgICAgICAgICAgZWNobzogY29udGVudCxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hcbiAgICAgICAgICAgICAgICB9KVxuICAgIFxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKHJlY29yZClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdQYXJzZSBFY2hvJywgcmVjb3JkKVxuXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgcmV0dXJuIGZvdW5kO1xuXG59XG5cblxuXG5cbi8qKlxuICogUGFyc2UgU25hcENvZGUgRXhwcmVzc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gUGFyc2VTbmFwQ29kZUV4cHJlc3Npb24obm9kZTogSFRNTEVsZW1lbnQsIGNhbGxiYWNrOiAocmVjb3JkOiBFeHByZXNzaW9uUmVjb3JkKSA9PiB2b2lkICl7XG5cbiAgICBjYWxsYmFjayA9IHR5cGVvZiBjYWxsYmFjayA9PSAnZnVuY3Rpb24nID8gY2FsbGJhY2sgOiAoKCk9Pnt9KTtcblxuICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuXG5cbiAgICBpZihub2RlLmNoaWxkTm9kZXMubGVuZ3RoKXtcblxuICAgICAgICBjb25zdCByZWNvcmQgPSBDcmVhdGVFeHByZXNzaW9uUmVjb3JkKHtcbiAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICB0eXBlOiAnc25hcGNvZGUnLFxuICAgICAgICAgICAgc25hcGNvZGU6IFtdXG4gICAgICAgIH0pXG5cbiAgICAgICAgbm9kZS5jaGlsZE5vZGVzLmZvckVhY2goY2hpbGQ9PntcblxuICAgICAgICAgICAgY29uc3QgbTogUGFyc2VTbmFwQ29kZUJsb2NrW10gPSBbXVxuXG4gICAgICAgICAgICBpZihjaGlsZCBpbnN0YW5jZW9mIFRleHQpe1xuXG4gICAgICAgICAgICAgICAgaWYoY2hpbGQudGV4dENvbnRlbnQpe1xuICAgIFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gWy4uLmNoaWxkLnRleHRDb250ZW50Lm1hdGNoQWxsKFN5bnRheFNuYXBDb2RlKV07XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKG1hdGNoZXMubGVuZ3RoKXtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIG0ucHVzaCggeyBub2RlOiBjaGlsZCwgbWF0Y2hlcyB9IClcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVjb3JkLnNuYXBjb2RlPy5wdXNoKCB7IG5vZGU6IGNoaWxkLCBtYXRjaGVzIH0gKVxuICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cblxuXG4gICAgICAgICAgICBpZihtLmxlbmd0aCl7XG5cbiAgICAgICAgICAgICAgICByZWNvcmQuc25hcGNvZGUgPSBtO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgfSlcbiAgICAgICAgXG5cbiAgICAgICAgaWYocmVjb3JkLnNuYXBjb2RlKXtcblxuICAgICAgICAgICAgaWYocmVjb3JkLnNuYXBjb2RlLmxlbmd0aCl7XG4gICAgXG4gICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH1cblxuXG4gICAgICAgIFxuICAgIH1cbiAgICBcblxuICAgIHJldHVybiBmb3VuZDtcblxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBGaW5kRXhwcmVzc2lvbnMoXG4gICAgXG4gICAgbm9kZTogSFRNTEVsZW1lbnQsIFxuICAgIFxuICAgIGNhbGxiYWNrOiAocmVjb3JkOiBFeHByZXNzaW9uUmVjb3JkKSA9PiB2b2lkLCBcbiAgICBcbiAgICAvLyBlcnJvckNhbGxiYWNrPzogKHJlYXNvbjogYW55KSA9PiB2b2lkXG4gICAgXG4pe1xuXG4gICAgY29uc3Qgbm9kZXMgPSBub2RlLmNoaWxkTm9kZXM7XG5cbiAgICBjb25zdCByZWNvcmRlcjogRXhwcmVzc2lvblJlY29yZFtdID0gW11cbiAgICBcblxuICAgIC8qKlxuICAgICAqIFBhcnNlIE5vZGUgQXR0cmlidXRlc1xuICAgICAqL1xuICAgIFBhcnNlQXR0cmlidXRlc0V4cHJlc3Npb24obm9kZSwgY2FsbGJhY2spXG4gICAgXG5cblxuICAgIC8qKlxuICAgICAqIFJlQ2FsbEJhY2tcbiAgICAgKi9cblxuICAgIGNvbnN0IHJlQ2FsbGJhY2sgPSAocmVjb3JkOiBFeHByZXNzaW9uUmVjb3JkKT0+e1xuXG4gICAgICAgIHJlY29yZGVyLnB1c2gocmVjb3JkKVxuXG4gICAgICAgIGNhbGxiYWNrKHJlY29yZClcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIFxuXG4gICAgLyoqXG4gICAgICogRmluZFxuICAgICAqL1xuICAgIGlmKG5vZGVzLmxlbmd0aCl7XG4gICAgICAgIFxuICAgICAgICBub2Rlcy5mb3JFYWNoKGNoaWxkPT57XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8qKiAqIEZpbmQgU25hcENvZGUgKi9cbiAgICAgICAgICAgIGNvbnN0IHNuYXBjb2RlID0gUGFyc2VTbmFwQ29kZUV4cHJlc3Npb24oY2hpbGQgYXMgSFRNTEVsZW1lbnQsIHJlQ2FsbGJhY2spO1xuXG5cbiAgICAgICAgICAgIC8qKiAqIEZpbmQgRGVlcCAqL1xuICAgICAgICAgICAgaWYoIXNuYXBjb2RlKXtcblxuICAgICAgICAgICAgICAgIEZpbmRFeHByZXNzaW9ucyhjaGlsZCBhcyBIVE1MRWxlbWVudCwgcmVDYWxsYmFjaylcbiAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZXtcblxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUud2FybignU3RvcCBGaW5kIG9uJywgY2hpbGQpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSlcbiAgICAgICAgXG4gICAgfVxuXG5cbiAgICBpZighbm9kZXMubGVuZ3RoKXtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRmluZCBFY2hvXG4gICAgICAgICAqL1xuICAgICAgICBQYXJzZUVjaG9FeHByZXNzaW9uKG5vZGUsIHJlQ2FsbGJhY2spXG4gICAgICAgIFxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVjb3JkZXI7XG4gICAgXG59XG5cblxuXG5cbiJdfQ==