import { SensenPaletteColor } from "./palette-color";
import { SensenToneColor } from "./tone-color";
export class ThemeColor {
    /**
     * ThemeColor Variable Name
     */
    static $(varname) {
        return (`var(--color-${(varname).replace(new RegExp("([A-Z])", "g"), '-$&').toLowerCase()})`);
    }
}
export default class SensenThemeColor {
    constructor() {
        this.input = [];
        this.palette = {};
        this.tone = {};
        this.DOM = null;
        this.injectionRefs = [];
        this.persist = false;
        this.init();
    }
    add(input) {
        this.input[this.input.length] = input;
        return this;
    }
    render(persist) {
        this.persist = typeof persist == 'boolean' ? persist : true;
        this.input.forEach(input => {
            if (input instanceof SensenPaletteColor ||
                input instanceof SensenToneColor) {
                this.build(input.Mixture());
            }
            else {
                throw (`This ThemeColor is not supported < ${input.name || 'undefined'} >`);
            }
        });
        return this;
    }
    /* Web Abilities - Begin */
    init() {
        this.DOM = document.querySelector('style[theme\\:color\\:ref]');
        if (!this.DOM) {
            this.DOM = document.createElement('style');
            this.DOM.setAttribute('type', 'text/css');
            this.DOM.setAttribute('theme\:color\:ref', '@transaction');
            document.head.appendChild(this.DOM);
        }
        return this;
    }
    build(input) {
        if ('mixed' in input) {
            const lines = [];
            const majRex = new RegExp("([A-Z])", "g");
            Object.keys(input.mixed).forEach(color => {
                const clone = input.mixed[color];
                Object.keys(input.mixed[color]).forEach(variante => {
                    lines[lines.length] = `${(`--color-${color}${variante == 'color' ? '' : `-${variante}`}`).replace(majRex, '-$&').toLowerCase()} : ${clone[variante]}`;
                });
            });
            this.Inject(input.nature, input.name, lines);
        }
        return this;
    }
    Inject(nature, name, code) {
        let embed;
        if (Array.isArray(code)) {
            code = code.join(';');
        }
        switch (nature) {
            case '@palette':
                embed = `\n:root[theme-color-palette="${name}"]{ ${code} }`;
                break;
            case '@tone':
                embed = `\n:root[theme-color-tone="${name}"]{ ${code} }`;
                break;
        }
        const ref = document.createTextNode(embed);
        this.DOM?.appendChild(ref);
        return this;
    }
    usePalette(name, letPersist = false) {
        const doc = document.documentElement;
        if (letPersist === true && this.persist === true) {
            name = localStorage.getItem('@sensen-theme-palette') || name;
            doc.setAttribute('theme-color-palette', name);
        }
        doc.setAttribute('theme-color-palette', name);
        localStorage.setItem('@sensen-theme-palette', name);
        return this;
    }
    useTone(name, letPersist = false) {
        const doc = document.documentElement;
        if (letPersist === true && this.persist === true) {
            name = localStorage.getItem('@sensen-theme-tone') || name;
            doc.setAttribute('theme-color-tone', name);
        }
        doc.setAttribute('theme-color-tone', name);
        localStorage.setItem('@sensen-theme-tone', name);
        return this;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9jb3JlL3RoZW1lLWNvbG9yL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRXJELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFNL0MsTUFBTSxPQUFPLFVBQVU7SUFHbkI7O09BRUc7SUFDSCxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQXdCO1FBRTdCLE9BQU8sQ0FBQyxlQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFHLEdBQUcsQ0FBQyxDQUFDO0lBRXBHLENBQUM7Q0FNSjtBQU9ELE1BQU0sQ0FBQyxPQUFPLE9BQU8sZ0JBQWdCO0lBa0JqQztRQWZBLFVBQUssR0FBa0IsRUFBRSxDQUFDO1FBRTFCLFlBQU8sR0FBdUIsRUFBd0IsQ0FBQztRQUV2RCxTQUFJLEdBQW9CLEVBQXFCLENBQUM7UUFFOUMsUUFBRyxHQUE0QixJQUFJLENBQUM7UUFFcEMsa0JBQWEsR0FBYSxFQUFFLENBQUM7UUFHN0IsWUFBTyxHQUFZLEtBQUssQ0FBQztRQU1yQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFFaEIsQ0FBQztJQUlELEdBQUcsQ0FBQyxLQUFrQjtRQUVsQixJQUFJLENBQUMsS0FBSyxDQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFFLEdBQUcsS0FBSyxDQUFDO1FBRXhDLE9BQU8sSUFBSSxDQUFDO0lBRWhCLENBQUM7SUFRRCxNQUFNLENBQUMsT0FBaUI7UUFFcEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLE9BQU8sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFFO1FBRTdELElB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SUFBSSxDQUFDO0lBRWhCLENBQUM7Q0FPSiIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IFNlbnNlbkNvbG9yIGZyb20gXCIuL2NvbG9yXCI7XG5pbXBvcnQgeyBTZW5zZW5Db2xvck5hdHVyZSB9IGZyb20gXCIuL2NvbG9yLnRcIjtcbmltcG9ydCB7IFNlbnNlblBhbGV0dGVDb2xvciB9IGZyb20gXCIuL3BhbGV0dGUtY29sb3JcIjtcbmltcG9ydCB7IFRoZW1lQ29sb3JQcm9wcyB9IGZyb20gXCIuL3RoZW1lLWNvbG9yLnRcIjtcbmltcG9ydCB7IFNlbnNlblRvbmVDb2xvciB9IGZyb20gXCIuL3RvbmUtY29sb3JcIjtcblxuXG5cblxuXG5leHBvcnQgY2xhc3MgVGhlbWVDb2xvcntcblxuXG4gICAgLyoqXG4gICAgICogVGhlbWVDb2xvciBWYXJpYWJsZSBOYW1lXG4gICAgICovXG4gICAgc3RhdGljICQodmFybmFtZTogVGhlbWVDb2xvclByb3BzKSA6IHN0cmluZ3tcblxuICAgICAgICByZXR1cm4gKGB2YXIoLS1jb2xvci0keyAodmFybmFtZSkucmVwbGFjZShuZXcgUmVnRXhwKFwiKFtBLVpdKVwiLCBcImdcIiksICctJCYnKS50b0xvd2VyQ2FzZSgpIH0pYCk7XG5cbiAgICB9XG5cblxuICAgIFxuICAgIFxuICAgIFxufVxuXG5cblxuXG5cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2Vuc2VuVGhlbWVDb2xvcntcblxuXG4gICAgaW5wdXQ6IFNlbnNlbkNvbG9yW10gPSBbXTtcblxuICAgIHBhbGV0dGU6IFNlbnNlblBhbGV0dGVDb2xvciA9IHt9IGFzIFNlbnNlblBhbGV0dGVDb2xvcjtcblxuICAgIHRvbmU6IFNlbnNlblRvbmVDb2xvciA9IHt9IGFzIFNlbnNlblRvbmVDb2xvcjtcblxuICAgIERPTTogSFRNTFN0eWxlRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gICAgaW5qZWN0aW9uUmVmczogc3RyaW5nW10gPSBbXTtcbiAgICBcblxuICAgIHBlcnNpc3Q6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBcblxuXG4gICAgY29uc3RydWN0b3IoKXtcblxuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgXG4gICAgfVxuXG5cblxuICAgIGFkZChpbnB1dDogU2Vuc2VuQ29sb3Ipe1xuXG4gICAgICAgIHRoaXMuaW5wdXRbIHRoaXMuaW5wdXQubGVuZ3RoIF0gPSBpbnB1dDtcblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgXG4gICAgfVxuXG4gICAgXG4gICAgXG4gICAgXG4gICAgXG5cblxuICAgIHJlbmRlcihwZXJzaXN0PzogYm9vbGVhbil7XG5cbiAgICAgICAgdGhpcy5wZXJzaXN0ID0gdHlwZW9mIHBlcnNpc3QgPT0gJ2Jvb2xlYW4nID8gcGVyc2lzdCA6IHRydWUgO1xuXG4gICAgICAgIHRoaXMuaW5wdXQuZm9yRWFjaChpbnB1dD0+e1xuXG4gICAgICAgICAgICBpZihcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpbnB1dCBpbnN0YW5jZW9mIFNlbnNlblBhbGV0dGVDb2xvciB8fFxuXG4gICAgICAgICAgICAgICAgaW5wdXQgaW5zdGFuY2VvZiBTZW5zZW5Ub25lQ29sb3JcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICl7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmJ1aWxkKGlucHV0Lk1peHR1cmUoKSlcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxzZXtcblxuICAgICAgICAgICAgICAgIHRocm93IChgVGhpcyBUaGVtZUNvbG9yIGlzIG5vdCBzdXBwb3J0ZWQgPCAkeyBpbnB1dC5uYW1lIHx8ICd1bmRlZmluZWQnIH0gPmApXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSlcblxuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBcbiAgICB9XG5cblxuXG5cblxuXG4gICAgXG5cbiAgICBcblxuICAgIC8qIFdlYiBBYmlsaXRpZXMgLSBCZWdpbiAqL1xuXG4gICAgaW5pdCgpe1xuXG4gICAgICAgIHRoaXMuRE9NID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignc3R5bGVbdGhlbWVcXFxcOmNvbG9yXFxcXDpyZWZdJyk7XG5cbiAgICAgICAgaWYoIXRoaXMuRE9NKXtcblxuICAgICAgICAgICAgdGhpcy5ET00gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuXG4gICAgICAgICAgICB0aGlzLkRPTS5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dC9jc3MnKVxuXG4gICAgICAgICAgICB0aGlzLkRPTS5zZXRBdHRyaWJ1dGUoJ3RoZW1lXFw6Y29sb3JcXDpyZWYnLCAnQHRyYW5zYWN0aW9uJylcblxuICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggdGhpcy5ET00gKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgfVxuXG5cbiAgICBidWlsZChpbnB1dDogU2Vuc2VuQ29sb3Ipe1xuXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGlmKCdtaXhlZCcgaW4gaW5wdXQpe1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gWyBdOyBcblxuICAgICAgICAgICAgY29uc3QgbWFqUmV4ID0gbmV3IFJlZ0V4cChcIihbQS1aXSlcIiwgXCJnXCIpO1xuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIE9iamVjdC5rZXlzKGlucHV0Lm1peGVkKS5mb3JFYWNoKGNvbG9yPT57XG5cbiAgICAgICAgICAgICAgICBjb25zdCBjbG9uZSA9IGlucHV0Lm1peGVkW2NvbG9yXSBhcyB7W0s6IHN0cmluZ106YW55fVxuXG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoaW5wdXQubWl4ZWRbY29sb3JdKS5mb3JFYWNoKHZhcmlhbnRlPT57XG5cbiAgICAgICAgICAgICAgICAgICAgbGluZXNbIGxpbmVzLmxlbmd0aCBdID0gYCR7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIChgLS1jb2xvci0keyBcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IgXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0keyBcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnRlID09ICdjb2xvcicgPyAnJyA6IGAtJHt2YXJpYW50ZX1gIFxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB9YCkucmVwbGFjZShtYWpSZXgsICctJCYnKS50b0xvd2VyQ2FzZSgpXG5cbiAgICAgICAgICAgICAgICAgICAgfSA6ICR7IGNsb25lW3ZhcmlhbnRlXSB9YDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5JbmplY3QoaW5wdXQubmF0dXJlLCBpbnB1dC5uYW1lLCBsaW5lcylcblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIFxuICAgIH1cblxuXG4gICAgSW5qZWN0KG5hdHVyZTogU2Vuc2VuQ29sb3JOYXR1cmUsIG5hbWU6IHN0cmluZywgY29kZTogc3RyaW5nIHwgc3RyaW5nW10pe1xuXG4gICAgICAgIGxldCBlbWJlZDogc3RyaW5nO1xuXG4gICAgICAgIGlmKEFycmF5LmlzQXJyYXkoY29kZSkpeyBjb2RlID0gY29kZS5qb2luKCc7Jyk7IH1cblxuICAgICAgICBzd2l0Y2gobmF0dXJlKXtcblxuXG4gICAgICAgICAgICBjYXNlICdAcGFsZXR0ZSc6XG5cbiAgICAgICAgICAgICAgICBlbWJlZCA9IGBcXG46cm9vdFt0aGVtZS1jb2xvci1wYWxldHRlPVwiJHsgbmFtZSB9XCJdeyAkeyBjb2RlIH0gfWA7XG5cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIGNhc2UgJ0B0b25lJzpcblxuICAgICAgICAgICAgICAgIGVtYmVkID0gYFxcbjpyb290W3RoZW1lLWNvbG9yLXRvbmU9XCIkeyBuYW1lIH1cIl17ICR7IGNvZGUgfSB9YDtcblxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBcblxuICAgICAgICB9XG5cblxuICAgICAgICBjb25zdCByZWYgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShlbWJlZCk7XG5cbiAgICAgICAgdGhpcy5ET00/LmFwcGVuZENoaWxkKHJlZik7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG5cbiAgICB9XG5cblxuXG4gICAgdXNlUGFsZXR0ZShuYW1lOiBzdHJpbmcsIGxldFBlcnNpc3Q6IGJvb2xlYW4gPSBmYWxzZSl7XG5cbiAgICAgICAgY29uc3QgZG9jID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuXG4gICAgICAgIGlmKGxldFBlcnNpc3QgPT09IHRydWUgJiYgdGhpcy5wZXJzaXN0ID09PSB0cnVlKXtcblxuICAgICAgICAgICAgbmFtZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdAc2Vuc2VuLXRoZW1lLXBhbGV0dGUnKSB8fCBuYW1lO1xuXG4gICAgICAgICAgICBkb2Muc2V0QXR0cmlidXRlKFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICd0aGVtZS1jb2xvci1wYWxldHRlJywgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICAgICAgZG9jLnNldEF0dHJpYnV0ZSgndGhlbWUtY29sb3ItcGFsZXR0ZScsIG5hbWUpO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdAc2Vuc2VuLXRoZW1lLXBhbGV0dGUnLCBuYW1lKTtcbiAgICAgICAgXG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIFxuICAgIH1cblxuXG5cbiAgICB1c2VUb25lKG5hbWU6IHN0cmluZywgbGV0UGVyc2lzdDogYm9vbGVhbiA9IGZhbHNlKXtcblxuICAgICAgICBjb25zdCBkb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICAgICAgaWYobGV0UGVyc2lzdCA9PT0gdHJ1ZSAmJiB0aGlzLnBlcnNpc3QgPT09IHRydWUpe1xuXG4gICAgICAgICAgICBuYW1lID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0BzZW5zZW4tdGhlbWUtdG9uZScpIHx8IG5hbWU7XG5cbiAgICAgICAgICAgIGRvYy5zZXRBdHRyaWJ1dGUoXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgJ3RoZW1lLWNvbG9yLXRvbmUnLCBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICBkb2Muc2V0QXR0cmlidXRlKCd0aGVtZS1jb2xvci10b25lJywgbmFtZSk7XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ0BzZW5zZW4tdGhlbWUtdG9uZScsIG5hbWUpO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICBcbiAgICB9XG5cblxuICAgIC8qIFdlYiBBYmlsaXRpZXMgLSBGaW4gKi9cblxuXG4gICAgXG59Il19