import { NativeDirectiveAttributes } from "./directive.native";
import { ArrayRange } from "./utilities";
/**
 * Expressions
 */
export const SyntaxEcho = new RegExp('{{(.*?)}}', 'g');
export const SyntaxSnapCode = new RegExp('{%(.*?)%}', 'g');
export const SyDetr = '%sn';
export const DirectiveAttributes = NativeDirectiveAttributes;
/**
 * Stabilize Echo Expression
 */
export function StabilizeEchoExpression(content, stop) {
    const echos = [...(content || '').matchAll(SyntaxEcho)];
    if (echos.length) {
        echos.map(m => {
            content = (content || '').replace(new RegExp((m[0]).replace(/[^\w\s]/gi, '\\$&'), 'g'), `<${SyDetr}=${m[1]} ${SyDetr}>`);
        });
    }
    else {
        if (stop) {
            return null;
        }
    }
    return content;
}
/**
 * Stabilize SnapCode Expression
 */
export function StabilizeSnapCodeExpression(content, stop) {
    const echos = [...(content || '').matchAll(SyntaxSnapCode)];
    if (echos.length) {
        echos.map(m => {
            content = (content || '').replace(new RegExp((m[0]).replace(/[^\w\s]/gi, '\\$&'), 'g'), `<${SyDetr}${m[1]} ${SyDetr}>`);
        });
    }
    else {
        if (stop) {
            return null;
        }
    }
    return content;
}
export function CreateExpressionRecord(state) {
    if ((state.node instanceof HTMLElement || state.node instanceof Node) && !state.mockup) {
        state.mockup = state.node.cloneNode(true);
    }
    return state;
}
/**
 * Parse Attributes
 */
export function ParseAttributesExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    if (node.attributes) {
        if (node.attributes.length) {
            Object.values(node.attributes).map(attribute => {
                /**
                 * Find Directive
                 */
                Object.values(NativeDirectiveAttributes.Availables || {})
                    .map(directive => {
                    const matches = [...attribute.name.matchAll(new RegExp(`^${directive.expression}`, 'gi'))];
                    if (matches.length) {
                        matches.forEach(match => {
                            const split = attribute.name?.substring((directive.expression || '')?.length).split('.');
                            const name = split[0];
                            const record = CreateExpressionRecord({
                                node,
                                directive,
                                match,
                                name,
                                type: 'directive',
                                mockup: attribute,
                                arguments: ArrayRange(split, 1)
                            });
                            callback(record);
                        });
                    }
                });
                /**
                 * Find Echo
                 */
                const matchesEcho = [...attribute.value.matchAll(SyntaxEcho)];
                if (matchesEcho.length) {
                    matchesEcho.forEach(match => {
                        const record = CreateExpressionRecord({
                            node,
                            attribute,
                            match,
                            type: 'attribute.echo',
                            mockup: attribute
                        });
                        callback(record);
                    });
                }
                /**
                 * Find SnapCode
                 */
                const matchesSnapCode = [...attribute.value.matchAll(SyntaxSnapCode)];
                if (matchesSnapCode.length) {
                    matchesSnapCode.forEach(match => {
                        const record = CreateExpressionRecord({
                            node,
                            attribute,
                            match,
                            type: 'attribute.snapcode',
                            mockup: attribute
                        });
                        callback(record);
                    });
                }
            });
        }
    }
    return ParseAttributesExpression;
}
/**
 * Parse Echo Expression
 */
export function ParseEchoExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    const content = (node instanceof Text)
        ? node.textContent
        : (node instanceof HTMLElement ? node.innerHTML : null);
    let found = false;
    if (content) {
        const matches = [...content?.matchAll(SyntaxEcho)];
        if (matches.length) {
            found = true;
            matches.forEach(match => {
                const record = CreateExpressionRecord({
                    node,
                    name: (match[1] || '').trim(),
                    type: 'echo',
                    echo: content,
                    match
                });
                callback(record);
            });
            // console.log('Parse Echo', record)
        }
    }
    return found;
}
/**
 * Parse SnapCode Expression
 */
export function ParseSnapCodeExpression(node, callback) {
    callback = typeof callback == 'function' ? callback : (() => { });
    let found = false;
    if (node.childNodes.length) {
        const record = CreateExpressionRecord({
            node,
            type: 'snapcode',
            snapcode: []
        });
        node.childNodes.forEach(child => {
            const m = [];
            if (child instanceof Text) {
                if (child.textContent) {
                    const matches = [...child.textContent.matchAll(SyntaxSnapCode)];
                    if (matches.length) {
                        m.push({ node: child, matches });
                        // record.snapcode?.push( { node: child, matches } )
                    }
                }
            }
            if (m.length) {
                record.snapcode = m;
                callback(record);
            }
        });
        if (record.snapcode) {
            if (record.snapcode.length) {
                found = true;
            }
        }
    }
    return found;
}
export function FindExpressions(node, callback) {
    const nodes = node.childNodes;
    const recorder = [];
    /**
     * Parse Node Attributes
     */
    ParseAttributesExpression(node, callback);
    /**
     * ReCallBack
     */
    const reCallback = (record) => {
        recorder.push(record);
        callback(record);
    };
    /**
     * Find
     */
    if (nodes.length) {
        nodes.forEach(child => {
            /** * Find SnapCode */
            const snapcode = ParseSnapCodeExpression(child, reCallback);
            /** * Find Deep */
            if (!snapcode) {
                FindExpressions(child, reCallback);
            }
            else {
                // console.warn('Stop Find on', child)
            }
        });
    }
    if (!nodes.length) {
        /**
         * Find Echo
         */
        ParseEchoExpression(node, reCallback);
    }
    return recorder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwcmVzc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL2NvcmUvZXhwcmVzc2lvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUUvRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBR3pDOztHQUVHO0FBS0gsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLElBQUksTUFBTSxDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQTtBQUV0RCxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsSUFBSSxNQUFNLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0FBRTFELE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQUE7QUFHM0IsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcseUJBQXlCLENBQUE7QUFLNUQ7O0dBRUc7QUFDSCxNQUFNLFVBQVUsdUJBQXVCLENBQUMsT0FBc0IsRUFBRSxJQUFjO0lBRTFFLE1BQU0sS0FBSyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBRSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQTtJQUVyRCxJQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUM7UUFFWixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQSxFQUFFO1lBRVQsT0FBTyxHQUFHLENBQUMsT0FBTyxJQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FDM0IsSUFBSSxNQUFNLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxFQUFHLEdBQUcsQ0FBRSxFQUN2RCxJQUFJLE1BQU0sSUFBSyxDQUFDLENBQUMsQ0FBQyxDQUFFLElBQUksTUFBTSxHQUFHLENBQ3BDLENBQUE7UUFFTCxDQUFDLENBQUMsQ0FBQTtLQUVMO1NBRUc7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S0FBSyxDQUFDO0FBRWpCLENBQUM7QUFHRCxNQUFNLFVBQVUsZUFBZSxDQUUzQixJQUFpQixFQUVqQixRQUE0QztJQU01QyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBRTlCLE1BQU0sUUFBUSxHQUF1QixFQUFFLENBQUE7SUFHdkM7O09BRUc7SUFDSCx5QkFBeUIsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFJekM7O09BRUc7SUFFSCxNQUFNLFVBQVUsR0FBRyxDQUFDLE1BQXdCLEVBQUMsRUFBRTtRQUUzQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBRXJCLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUVwQixDQUFDLENBQUE7SUFJRDs7T0FFRztJQUNILElBQUcsS0FBSyxDQUFDLE1BQU0sRUFBQztRQUVaLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFBLEVBQUU7WUFFakIsc0JBQXNCO1lBQ3RCLE1BQU0sUUFBUSxHQUFHLHVCQUF1QixDQUFDLEtBQW9CLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFHM0Usa0JBQWtCO1lBQ2xCLElBQUcsQ0FBQyxRQUFRLEVBQUM7Z0JBRVQsZUFBZSxDQUFDLEtBQW9CLEVBQUUsVUFBVSxDQUFDLENBQUE7YUFFcEQ7aUJBRUc7Z0JBRUEsc0NBQXNDO2FBRXpDO1FBRUwsQ0FBQyxDQUFDLENBQUE7S0FFTDtJQUdELElBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFDO1FBRWI7O1dBRUc7UUFDSCxtQkFBbUIsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUE7S0FFeEM7SUFFRCxPQUFPLFFBQVEsQ0FBQztBQUVwQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmF0aXZlRGlyZWN0aXZlQXR0cmlidXRlcyB9IGZyb20gXCIuL2RpcmVjdGl2ZS5uYXRpdmVcIjtcbmltcG9ydCB7IEV4cHJlc3Npb25SZWNvcmQsIFBhcnNlU25hcENvZGVCbG9jayB9IGZyb20gXCIuL2luZGV4LnRcIjtcbmltcG9ydCB7IEFycmF5UmFuZ2UgfSBmcm9tIFwiLi91dGlsaXRpZXNcIjtcblxuXG4vKipcbiAqIEV4cHJlc3Npb25zXG4gKi9cblxuXG5cblxuZXhwb3J0IGNvbnN0IFN5bnRheEVjaG8gPSBuZXcgUmVnRXhwKCd7eyguKj8pfX0nLCAnZycpXG5cbmV4cG9ydCBjb25zdCBTeW50YXhTbmFwQ29kZSA9IG5ldyBSZWdFeHAoJ3slKC4qPyklfScsICdnJylcblxuZXhwb3J0IGNvbnN0IFN5RGV0ciA9ICclc24nXG5cblxuZXhwb3J0IGNvbnN0IERpcmVjdGl2ZUF0dHJpYnV0ZXMgPSBOYXRpdmVEaXJlY3RpdmVBdHRyaWJ1dGVzXG5cblxuXG5cbi8qKlxuICogU3RhYmlsaXplIEVjaG8gRXhwcmVzc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gU3RhYmlsaXplRWNob0V4cHJlc3Npb24oY29udGVudDogc3RyaW5nIHwgbnVsbCwgc3RvcD86IGJvb2xlYW4pe1xuXG4gICAgY29uc3QgZWNob3MgPSBbLi4uKGNvbnRlbnR8fCcnKS5tYXRjaEFsbChTeW50YXhFY2hvKV1cbiAgICAgXG4gICAgaWYoZWNob3MubGVuZ3RoKXtcbiAgICAgICAgXG4gICAgICAgIGVjaG9zLm1hcChtPT57XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnRlbnQgPSAoY29udGVudHx8JycpLnJlcGxhY2UoXG4gICAgICAgICAgICAgICAgbmV3IFJlZ0V4cCggKG1bMF0pLnJlcGxhY2UoL1teXFx3XFxzXS9naSwgJ1xcXFwkJicpICwgJ2cnICksIFxuICAgICAgICAgICAgICAgIGA8JHtTeURldHJ9PSR7IG1bMV0gfSAke1N5RGV0cn0+YCBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgIH1cblxuICAgIGVsc2V7XG5cbiAgICAgICAgaWYoc3RvcCl7IHJldHVybiBudWxsOyB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gY29udGVudDtcblxufVxuXG5cblxuXG4vKipcbiAqIFN0YWJpbGl6ZSBTbmFwQ29kZSBFeHByZXNzaW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBTdGFiaWxpemVTbmFwQ29kZUV4cHJlc3Npb24oY29udGVudDogc3RyaW5nIHwgbnVsbCwgc3RvcD86IGJvb2xlYW4pe1xuXG4gICAgY29uc3QgZWNob3MgPSBbLi4uKGNvbnRlbnR8fCcnKS5tYXRjaEFsbChTeW50YXhTbmFwQ29kZSldXG4gICAgIFxuICAgIGlmKGVjaG9zLmxlbmd0aCl7XG4gICAgICAgIFxuICAgICAgICBlY2hvcy5tYXAobT0+e1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb250ZW50ID0gKGNvbnRlbnR8fCcnKS5yZXBsYWNlKFxuICAgICAgICAgICAgICAgIG5ldyBSZWdFeHAoIChtWzBdKS5yZXBsYWNlKC9bXlxcd1xcc10vZ2ksICdcXFxcJCYnKSAsICdnJyApLCBcbiAgICAgICAgICAgICAgICBgPCR7U3lEZXRyfSR7IG1bMV0gfSAke1N5RGV0cn0+YCBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgfSlcbiAgICAgICAgICAgIFxuICAgIH1cblxuICAgIGVsc2V7XG5cbiAgICAgICAgaWYoc3RvcCl7IHJldHVybiBudWxsOyB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gY29udGVudDtcblxufVxuXG5cblxuXG5cbmV4cG9ydCBmdW5jdGlvbiBDcmVhdGVFeHByZXNzaW9uUmVjb3JkKHN0YXRlOiBFeHByZXNzaW9uUmVjb3JkKSA6IEV4cHJlc3Npb25SZWNvcmR7XG5cbiAgICBpZigoc3RhdGUubm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50IHx8IHN0YXRlLm5vZGUgaW5zdGFuY2VvZiBOb2RlKSAmJiAhc3RhdGUubW9ja3VwKXtcblxuICAgICAgICBzdGF0ZS5tb2NrdXAgPSBzdGF0ZS5ub2RlLmNsb25lTm9kZSh0cnVlKVxuXG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlXG5cbn1cblxuXG5cbi8qKlxuICogUGFyc2UgQXR0cmlidXRlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gUGFyc2VBdHRyaWJ1dGVzRXhwcmVzc2lvbihub2RlOiBIVE1MRWxlbWVudCwgY2FsbGJhY2s6IChyZWNvcmQ6IEV4cHJlc3Npb25SZWNvcmQpID0+IHZvaWQgKXtcblxuXG4gICAgY2FsbGJhY2sgPSB0eXBlb2YgY2FsbGJhY2sgPT0gJ2Z1bmN0aW9uJyA/IGNhbGxiYWNrIDogKCgpPT57fSk7XG5cblxuICAgIGlmKG5vZGUuYXR0cmlidXRlcyl7XG4gICAgICAgICAgICBcbiAgICAgICAgaWYobm9kZS5hdHRyaWJ1dGVzLmxlbmd0aCl7XG4gICAgXG4gICAgICAgICAgICBPYmplY3QudmFsdWVzKG5vZGUuYXR0cmlidXRlcykubWFwKGF0dHJpYnV0ZT0+e1xuICAgIFxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRmluZCBEaXJlY3RpdmVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKE5hdGl2ZURpcmVjdGl2ZUF0dHJpYnV0ZXMuQXZhaWxhYmxlc3x8e30pXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAubWFwKGRpcmVjdGl2ZT0+eyBcblxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gWy4uLmF0dHJpYnV0ZS5uYW1lLm1hdGNoQWxsKG5ldyBSZWdFeHAoYF4keyBkaXJlY3RpdmUuZXhwcmVzc2lvbiB9YCwgJ2dpJykpXVxuXG4gICAgICAgICAgICAgICAgICAgIGlmKG1hdGNoZXMubGVuZ3RoKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKG1hdGNoPT57XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGxpdCA9IGF0dHJpYnV0ZS5uYW1lPy5zdWJzdHJpbmcoKGRpcmVjdGl2ZS5leHByZXNzaW9ufHwnJyk/Lmxlbmd0aCkuc3BsaXQoJy4nKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IHNwbGl0WzBdXG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IENyZWF0ZUV4cHJlc3Npb25SZWNvcmQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3RpdmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGlyZWN0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9ja3VwOiBhdHRyaWJ1dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3VtZW50czogQXJyYXlSYW5nZTxzdHJpbmc+KHNwbGl0LCAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0pXG5cblxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogRmluZCBFY2hvXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlc0VjaG8gPSBbLi4uYXR0cmlidXRlLnZhbHVlLm1hdGNoQWxsKFN5bnRheEVjaG8pXTtcblxuICAgICAgICAgICAgICAgIGlmKG1hdGNoZXNFY2hvLmxlbmd0aCl7XG5cbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc0VjaG8uZm9yRWFjaChtYXRjaD0+e1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmQgPSBDcmVhdGVFeHByZXNzaW9uUmVjb3JkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYXR0cmlidXRlLmVjaG8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vY2t1cDogYXR0cmlidXRlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhyZWNvcmQpXG5cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuXG5cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEZpbmQgU25hcENvZGVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzU25hcENvZGUgPSBbLi4uYXR0cmlidXRlLnZhbHVlLm1hdGNoQWxsKFN5bnRheFNuYXBDb2RlKV07XG5cbiAgICAgICAgICAgICAgICBpZihtYXRjaGVzU25hcENvZGUubGVuZ3RoKXtcblxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVzU25hcENvZGUuZm9yRWFjaChtYXRjaD0+e1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmQgPSBDcmVhdGVFeHByZXNzaW9uUmVjb3JkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnYXR0cmlidXRlLnNuYXBjb2RlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2NrdXA6IGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KVxuICAgIFxuICAgIFxuICAgICAgICB9XG5cbiAgICB9XG4gICAgXG4gICAgXG4gICAgcmV0dXJuIFBhcnNlQXR0cmlidXRlc0V4cHJlc3Npb247XG4gICAgXG59XG5cblxuXG4vKipcbiAqIFBhcnNlIEVjaG8gRXhwcmVzc2lvblxuICovXG5leHBvcnQgZnVuY3Rpb24gUGFyc2VFY2hvRXhwcmVzc2lvbihub2RlOiBIVE1MRWxlbWVudCwgY2FsbGJhY2s6IChyZWNvcmQ6IEV4cHJlc3Npb25SZWNvcmQpID0+IHZvaWQgKXtcblxuICAgIGNhbGxiYWNrID0gdHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6ICgoKT0+e30pO1xuXG4gICAgY29uc3QgY29udGVudCA9IChub2RlIGluc3RhbmNlb2YgVGV4dCkgXG4gICAgICAgID8gbm9kZS50ZXh0Q29udGVudCBcbiAgICAgICAgOiAobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50ID8gbm9kZS5pbm5lckhUTUwgOiBudWxsKTtcblxuICAgIFxuICAgIGxldCBmb3VuZCA9IGZhbHNlXG5cblxuICAgIGlmKGNvbnRlbnQpe1xuXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbLi4uY29udGVudD8ubWF0Y2hBbGwoU3ludGF4RWNobyldXG5cbiAgICAgICAgaWYobWF0Y2hlcy5sZW5ndGgpe1xuXG4gICAgICAgICAgICBmb3VuZCA9IHRydWU7XG5cbiAgICAgICAgICAgIG1hdGNoZXMuZm9yRWFjaChtYXRjaD0+e1xuXG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkID0gQ3JlYXRlRXhwcmVzc2lvblJlY29yZCh7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUsXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IChtYXRjaFsxXXx8JycpLnRyaW0oKSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2VjaG8nLFxuICAgICAgICAgICAgICAgICAgICBlY2hvOiBjb250ZW50LFxuICAgICAgICAgICAgICAgICAgICBtYXRjaFxuICAgICAgICAgICAgICAgIH0pXG4gICAgXG4gICAgICAgICAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1BhcnNlIEVjaG8nLCByZWNvcmQpXG5cbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG5cbiAgICByZXR1cm4gZm91bmQ7XG5cbn1cblxuXG5cblxuLyoqXG4gKiBQYXJzZSBTbmFwQ29kZSBFeHByZXNzaW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBQYXJzZVNuYXBDb2RlRXhwcmVzc2lvbihub2RlOiBIVE1MRWxlbWVudCwgY2FsbGJhY2s6IChyZWNvcmQ6IEV4cHJlc3Npb25SZWNvcmQpID0+IHZvaWQgKXtcblxuICAgIGNhbGxiYWNrID0gdHlwZW9mIGNhbGxiYWNrID09ICdmdW5jdGlvbicgPyBjYWxsYmFjayA6ICgoKT0+e30pO1xuXG4gICAgbGV0IGZvdW5kID0gZmFsc2U7XG5cblxuICAgIGlmKG5vZGUuY2hpbGROb2Rlcy5sZW5ndGgpe1xuXG4gICAgICAgIGNvbnN0IHJlY29yZCA9IENyZWF0ZUV4cHJlc3Npb25SZWNvcmQoe1xuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIHR5cGU6ICdzbmFwY29kZScsXG4gICAgICAgICAgICBzbmFwY29kZTogW11cbiAgICAgICAgfSlcblxuICAgICAgICBub2RlLmNoaWxkTm9kZXMuZm9yRWFjaChjaGlsZD0+e1xuXG4gICAgICAgICAgICBjb25zdCBtOiBQYXJzZVNuYXBDb2RlQmxvY2tbXSA9IFtdXG5cbiAgICAgICAgICAgIGlmKGNoaWxkIGluc3RhbmNlb2YgVGV4dCl7XG5cbiAgICAgICAgICAgICAgICBpZihjaGlsZC50ZXh0Q29udGVudCl7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbLi4uY2hpbGQudGV4dENvbnRlbnQubWF0Y2hBbGwoU3ludGF4U25hcENvZGUpXTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYobWF0Y2hlcy5sZW5ndGgpe1xuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgbS5wdXNoKCB7IG5vZGU6IGNoaWxkLCBtYXRjaGVzIH0gKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZWNvcmQuc25hcGNvZGU/LnB1c2goIHsgbm9kZTogY2hpbGQsIG1hdGNoZXMgfSApXG4gICAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgIGlmKG0ubGVuZ3RoKXtcblxuICAgICAgICAgICAgICAgIHJlY29yZC5zbmFwY29kZSA9IG07XG5cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhyZWNvcmQpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB9KVxuICAgICAgICBcblxuICAgICAgICBpZihyZWNvcmQuc25hcGNvZGUpe1xuXG4gICAgICAgICAgICBpZihyZWNvcmQuc25hcGNvZGUubGVuZ3RoKXtcbiAgICBcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG5cbiAgICAgICAgXG4gICAgfVxuICAgIFxuXG4gICAgcmV0dXJuIGZvdW5kO1xuXG59XG5cblxuZXhwb3J0IGZ1bmN0aW9uIEZpbmRFeHByZXNzaW9ucyhcbiAgICBcbiAgICBub2RlOiBIVE1MRWxlbWVudCwgXG4gICAgXG4gICAgY2FsbGJhY2s6IChyZWNvcmQ6IEV4cHJlc3Npb25SZWNvcmQpID0+IHZvaWQsIFxuICAgIFxuICAgIC8vIGVycm9yQ2FsbGJhY2s/OiAocmVhc29uOiBhbnkpID0+IHZvaWRcbiAgICBcbil7XG5cbiAgICBjb25zdCBub2RlcyA9IG5vZGUuY2hpbGROb2RlcztcblxuICAgIGNvbnN0IHJlY29yZGVyOiBFeHByZXNzaW9uUmVjb3JkW10gPSBbXVxuICAgIFxuXG4gICAgLyoqXG4gICAgICogUGFyc2UgTm9kZSBBdHRyaWJ1dGVzXG4gICAgICovXG4gICAgUGFyc2VBdHRyaWJ1dGVzRXhwcmVzc2lvbihub2RlLCBjYWxsYmFjaylcbiAgICBcblxuXG4gICAgLyoqXG4gICAgICogUmVDYWxsQmFja1xuICAgICAqL1xuXG4gICAgY29uc3QgcmVDYWxsYmFjayA9IChyZWNvcmQ6IEV4cHJlc3Npb25SZWNvcmQpPT57XG5cbiAgICAgICAgcmVjb3JkZXIucHVzaChyZWNvcmQpXG5cbiAgICAgICAgY2FsbGJhY2socmVjb3JkKVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgXG5cbiAgICAvKipcbiAgICAgKiBGaW5kXG4gICAgICovXG4gICAgaWYobm9kZXMubGVuZ3RoKXtcbiAgICAgICAgXG4gICAgICAgIG5vZGVzLmZvckVhY2goY2hpbGQ9PntcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLyoqICogRmluZCBTbmFwQ29kZSAqL1xuICAgICAgICAgICAgY29uc3Qgc25hcGNvZGUgPSBQYXJzZVNuYXBDb2RlRXhwcmVzc2lvbihjaGlsZCBhcyBIVE1MRWxlbWVudCwgcmVDYWxsYmFjayk7XG5cblxuICAgICAgICAgICAgLyoqICogRmluZCBEZWVwICovXG4gICAgICAgICAgICBpZighc25hcGNvZGUpe1xuXG4gICAgICAgICAgICAgICAgRmluZEV4cHJlc3Npb25zKGNoaWxkIGFzIEhUTUxFbGVtZW50LCByZUNhbGxiYWNrKVxuICAgIFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBlbHNle1xuXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS53YXJuKCdTdG9wIEZpbmQgb24nLCBjaGlsZClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICB9XG5cblxuICAgIGlmKCFub2Rlcy5sZW5ndGgpe1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaW5kIEVjaG9cbiAgICAgICAgICovXG4gICAgICAgIFBhcnNlRWNob0V4cHJlc3Npb24obm9kZSwgcmVDYWxsYmFjaylcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZWNvcmRlcjtcbiAgICBcbn1cblxuXG5cblxuIl19